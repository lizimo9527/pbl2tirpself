# Dify AI 集成说明

## 概述

本项目已成功集成 Dify AI 工具，为小程序提供了智能旅行助手功能。AI 助手能够根据用户需求生成个性化的旅行路线规划。

## 配置信息

- **Dify 服务器**: `https://dify.aipfuture.com`
- **应用 ID**: `1i1suD6MWKtMYQuq`
- **聊天端点**: `/v1/chat-messages`

## 功能特性

### 1. 智能旅行规划
- 根据用户输入的目的地、天数、预算等信息生成个性化旅行路线
- 支持多种旅行类型：家庭游、情侣游、独自旅行等
- 智能提取旅行信息并生成地图标记数据

### 2. 备用回复机制
- 当 Dify AI 服务不可用时，自动切换到关键词匹配的备用回复系统
- 支持常见目的地：北京、上海、广州、深圳、杭州、成都、西安、云南等

### 3. 实时聊天交互
- 支持流式聊天体验
- 显示 AI 思考状态
- 自动滚动到最新消息

## 文件结构

```
├── config/
│   └── dify.config.js          # Dify 配置
├── services/
│   ├── difyChatService.js      # Dify 聊天服务
│   └── difyService.js          # Dify 工作流服务
├── pages/ai-chat/
│   ├── ai-chat.vue             # 主聊天界面
│   └── test-ai-chat.vue        # 测试页面
└── DIFY_AI_INTEGRATION_README.md
```

## 使用方法

### 1. 测试 AI 集成

在微信开发者工具中，可以通过以下方式测试 AI 功能：

1. 打开 `pages/ai-chat/test-ai-chat.vue` 页面
2. 点击不同的测试按钮验证功能：
   - **测试 Dify 连接**: 验证与 Dify 服务器的连接
   - **测试聊天功能**: 测试完整的聊天流程
   - **测试备用回复**: 验证备用回复机制

### 2. 使用 AI 聊天功能

1. 打开 `pages/ai-chat/ai-chat.vue` 页面
2. 在输入框中描述您的旅行需求，例如：
   - "我想去云南大理丽江玩5天，预算8000元"
   - "带家人去北京旅游，有老人小孩，行程要轻松"
   - "周末去杭州西湖周边，喜欢自然风光和美食"

3. AI 助手会为您生成详细的旅行路线规划

## 技术实现

### Dify 聊天服务 (`difyChatService.js`)

- 使用 Dify 的聊天 API 进行智能对话
- 支持会话管理，保持对话上下文
- 自动解析 AI 回复中的旅行信息
- 提供备用回复机制确保服务稳定性

### 配置管理 (`dify.config.js`)

- 集中管理 Dify 相关配置
- 支持多个应用和工作流配置
- 提供超时和错误处理配置

### 聊天界面 (`ai-chat.vue`)

- 现代化的聊天界面设计
- 支持用户和 AI 消息的区分显示
- 提供快捷输入提示和示例
- 集成地图数据生成功能

## 故障排除

### 常见问题

1. **AI 回复失败**
   - 检查网络连接
   - 验证 Dify 服务器配置
   - 查看控制台错误信息

2. **备用回复不工作**
   - 检查关键词匹配逻辑
   - 验证备用回复内容

3. **地图数据不显示**
   - 检查目的地提取逻辑
   - 验证坐标数据配置

### 调试方法

1. 打开微信开发者工具的控制台
2. 查看网络请求状态
3. 使用测试页面进行功能验证

## 扩展建议

1. **增加更多目的地支持**
   - 在 `difyChatService.js` 中扩展坐标数据
   - 添加更多城市的旅行模板

2. **优化 AI 回复质量**
   - 在 Dify 平台优化提示词
   - 增加旅行知识库

3. **增强用户体验**
   - 添加语音输入支持
   - 实现图片识别功能
   - 增加旅行攻略导出功能

## 注意事项

- 确保 Dify 应用配置正确
- 注意 API 调用频率限制
- 定期测试备用回复功能
- 关注 Dify 服务的稳定性

## 版本信息

- **当前版本**: v1.0.0
- **集成状态**: ✅ 已完成
- **测试状态**: ✅ 已通过基本测试

---

如有问题，请查看相关代码文件或联系开发团队。