# TripSelf 数据库初始化执行指南

## 方法一：通过Supabase控制台执行（推荐）

### 步骤1：登录Supabase控制台
1. 访问 [Supabase官网](https://supabase.com)
2. 登录您的账户
3. 进入项目 `brcwdpcpgruzvbsohwat` 的控制台

### 步骤2：执行SQL脚本
1. 在左侧菜单中点击 **SQL Editor**
2. 点击 **New Query** 创建新查询
3. 复制 `execute_init.sql` 文件中的全部内容
4. 粘贴到SQL编辑器中
5. 点击 **Run** 或按 `Ctrl+Enter` 执行

### 步骤3：验证执行结果
执行完成后，您应该看到：
- "数据库初始化完成！" 消息
- 已创建的表列表
- 示例数据统计

## 方法二：通过MCP工具执行（需要配置访问令牌）

如果您的MCP服务器已正确配置访问令牌，可以使用以下命令：

```bash
# 需要先配置正确的访问令牌
SUPABASE_ACCESS_TOKEN=sbp_01d1a60cfe44f44e61f2cdc683b579505ae99c2f

# 然后执行迁移
npx supabase migration apply init_database
```

## 数据库结构概览

初始化脚本将创建以下7个表：

### 1. users - 用户表
- 存储用户基本信息
- 包含邮箱、用户名、头像等字段

### 2. travel_plans - 攻略表  
- 存储旅行攻略主信息
- 包含标题、目的地、预算、旅行风格等

### 3. plan_days - 行程天表
- 存储攻略的每日行程安排
- 与攻略表关联

### 4. plan_items - 行程项表
- 存储每日的具体行程项目
- 包含景点、餐饮、住宿等类型

### 5. budget_items - 预算项表
- 存储详细的预算项目
- 按类别分类

### 6. plan_templates - 攻略模板表
- 存储预设的攻略模板
- 方便用户快速创建攻略

### 7. template_items - 模板行程项表
- 存储模板的具体行程项目

## 示例数据

脚本会自动插入：
- 2个测试用户
- 8个攻略模板（北京、上海、成都、西安、河北等）
- 多个模板行程项
- 2个示例攻略

## 索引优化

为提高查询性能，脚本还创建了以下索引：
- 用户ID索引
- 攻略状态索引  
- 各种外键关联索引

## 注意事项

1. **备份数据**：执行前请确保没有重要数据，脚本会创建新表
2. **权限检查**：确保数据库用户有创建表的权限
3. **网络连接**：确保能正常访问Supabase服务
4. **错误处理**：如果执行失败，请检查SQL语法和权限设置

## 验证方法

执行成功后，您可以通过以下方式验证：

1. 在Supabase控制台的 **Table Editor** 中查看表结构
2. 使用SQL查询验证数据：
   ```sql
   SELECT COUNT(*) as user_count FROM users;
   SELECT COUNT(*) as template_count FROM plan_templates;
   ```

## 后续操作

数据库初始化完成后，您可以：
1. 在小程序中测试数据同步功能
2. 通过 `supabaseDirectService.js` 进行数据操作
3. 根据需要调整表结构或添加更多示例数据