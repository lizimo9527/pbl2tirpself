{"version":3,"file":"map.config.js","sources":["config/map.config.js"],"sourcesContent":["// 腾讯地图配置\r\nconst mapConfig = {\r\n  // 腾讯地图开发者密钥（需要申请）\r\n  key: 'WAOBZ-VZZKB-BY5UJ-NTNHU-5YXJQ-JEBWH', // 腾讯地图API密钥\r\n  \r\n  // 地图默认配置\r\n  defaultCenter: {\r\n    longitude: 116.3974, // 北京经度\r\n    latitude: 39.9093    // 北京纬度\r\n  },\r\n  \r\n  // 地图缩放级别\r\n  zoomLevel: 12,\r\n  \r\n  // 地图样式\r\n  mapStyle: 'standard', // standard:标准, dark:深色, light:浅色\r\n  \r\n  // 控件配置\r\n  controls: {\r\n    scale: true,     // 比例尺\r\n    zoom: true,      // 缩放控件\r\n    compass: true,   // 指南针\r\n    location: true   // 定位控件\r\n  },\r\n  \r\n  // 标记点配置\r\n  markers: {\r\n    defaultIcon: '/static/images/map/marker.png',\r\n    selectedIcon: '/static/images/map/marker-selected.png',\r\n    size: { width: 30, height: 30 }\r\n  }\r\n}\r\n\r\n// 腾讯地图API URL\r\nconst mapApiUrls = {\r\n  // 逆地址解析（坐标转地址）\r\n  reverseGeocoder: 'https://apis.map.qq.com/ws/geocoder/v1/',\r\n  \r\n  // 地址解析（地址转坐标）\r\n  geocoder: 'https://apis.map.qq.com/ws/geocoder/v1/',\r\n  \r\n  // 路线规划\r\n  direction: 'https://apis.map.qq.com/ws/direction/v1/',\r\n  \r\n  // 地点搜索\r\n  search: 'https://apis.map.qq.com/ws/place/v1/search/',\r\n  \r\n  // 周边搜索\r\n  around: 'https://apis.map.qq.com/ws/place/v1/around/'\r\n}\r\n\r\n// 地图工具函数\r\nconst mapUtils = {\r\n  // 获取当前位置\r\n  getCurrentLocation() {\r\n    return new Promise((resolve, reject) => {\r\n      uni.getLocation({\r\n        type: 'gcj02', // 坐标系类型，gcj02为火星坐标系\r\n        success: (res) => {\r\n          resolve({\r\n            longitude: res.longitude,\r\n            latitude: res.latitude,\r\n            speed: res.speed,\r\n            accuracy: res.accuracy\r\n          })\r\n        },\r\n        fail: (err) => {\r\n          reject(err)\r\n        }\r\n      })\r\n    })\r\n  },\r\n  \r\n  // 地址解析（地址转坐标）\r\n  geocode(address, region = '') {\r\n    return new Promise((resolve, reject) => {\r\n      const requestData = {\r\n        key: mapConfig.key,\r\n        address: address\r\n      }\r\n      // 只有当region不为空时才添加region参数\r\n      if (region && region.trim()) {\r\n        requestData.region = region.trim()\r\n      }\r\n      \r\n      uni.request({\r\n        url: mapApiUrls.geocoder,\r\n        data: requestData,\r\n        success: (res) => {\r\n          if (res.data.status === 0) {\r\n            resolve(res.data.result)\r\n          } else {\r\n            reject(new Error(res.data.message || '地址解析失败'))\r\n          }\r\n        },\r\n        fail: (err) => {\r\n          reject(new Error('网络请求失败: ' + (err.errMsg || '未知错误')))\r\n        }\r\n      })\r\n    })\r\n  },\r\n  \r\n  // 逆地址解析（坐标转地址）\r\n  reverseGeocode(latitude, longitude) {\r\n    return new Promise((resolve, reject) => {\r\n      uni.request({\r\n        url: mapApiUrls.reverseGeocoder,\r\n        data: {\r\n          key: mapConfig.key,\r\n          location: `${latitude},${longitude}`,\r\n          get_poi: 0 // 不返回周边POI列表\r\n        },\r\n        success: (res) => {\r\n          if (res.data.status === 0) {\r\n            resolve(res.data.result)\r\n          } else {\r\n            reject(new Error(res.data.message))\r\n          }\r\n        },\r\n        fail: reject\r\n      })\r\n    })\r\n  },\r\n  \r\n  // 搜索地点\r\n  searchPlaces(keyword, region = '') {\r\n    return new Promise((resolve, reject) => {\r\n      const requestData = {\r\n        key: mapConfig.key,\r\n        keyword: keyword,\r\n        page_size: 20,\r\n        page_index: 1\r\n      }\r\n      // 腾讯地图地点搜索API使用boundary参数，格式为region(城市名)\r\n      // 只有当region不为空时才添加boundary参数\r\n      if (region && region.trim()) {\r\n        requestData.boundary = `region(${region.trim()})`\r\n      }\r\n      // 注意：不要同时传递region和boundary参数，腾讯地图API会报错\r\n      \r\n      uni.request({\r\n        url: mapApiUrls.search,\r\n        data: requestData,\r\n        success: (res) => {\r\n          if (res.data.status === 0) {\r\n            resolve(res.data.data || [])\r\n          } else {\r\n            reject(new Error(res.data.message || '搜索失败'))\r\n          }\r\n        },\r\n        fail: (err) => {\r\n          reject(new Error('网络请求失败: ' + (err.errMsg || '未知错误')))\r\n        }\r\n      })\r\n    })\r\n  },\r\n  \r\n  // 路线规划\r\n  getRoute(from, to, mode = 'driving') {\r\n    return new Promise((resolve, reject) => {\r\n      uni.request({\r\n        url: mapApiUrls.direction,\r\n        data: {\r\n          key: mapConfig.key,\r\n          from: `${from.latitude},${from.longitude}`,\r\n          to: `${to.latitude},${to.longitude}`,\r\n          output: 'json',\r\n          mode: mode // driving:驾车, walking:步行, bicycling:骑行\r\n        },\r\n        success: (res) => {\r\n          if (res.data.status === 0) {\r\n            resolve(res.data.result)\r\n          } else {\r\n            reject(new Error(res.data.message))\r\n          }\r\n        },\r\n        fail: reject\r\n      })\r\n    })\r\n  }\r\n}\r\n\r\nexport { mapConfig, mapApiUrls, mapUtils }"],"names":["uni"],"mappings":"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"}