{"version":3,"file":"difyChatService.js","sources":["services/difyChatService.js"],"sourcesContent":["// DifyèŠå¤©æœåŠ¡ - ä¸“é—¨ç”¨äºä¸DifyèŠå¤©åº”ç”¨äº¤äº’\r\nimport difyConfig from '@/config/dify.config.js';\r\n\r\nclass DifyChatService {\r\n  constructor() {\r\n    // DifyèŠå¤©åº”ç”¨é…ç½®\r\n    this.baseURL = difyConfig.server.baseURL;\r\n    this.appId = difyConfig.applications.travelAssistant.appId;\r\n    this.chatEndpoint = difyConfig.applications.travelAssistant.chatEndpoint;\r\n    this.conversationId = null; // ä¼šè¯ID\r\n  }\r\n\r\n  /**\r\n   * åˆå§‹åŒ–èŠå¤©ä¼šè¯\r\n   */\r\n  async initConversation() {\r\n    try {\r\n      // ç”Ÿæˆå”¯ä¸€çš„ä¼šè¯ID\r\n      this.conversationId = 'conv_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);\r\n      return this.conversationId;\r\n    } catch (error) {\r\n      console.error('åˆå§‹åŒ–ä¼šè¯å¤±è´¥:', error);\r\n      this.conversationId = 'conv_default_' + Date.now();\r\n      return this.conversationId;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * å‘é€æ¶ˆæ¯åˆ°DifyèŠå¤©åº”ç”¨\r\n   * @param {string} message - ç”¨æˆ·æ¶ˆæ¯\r\n   * @param {string} conversationId - ä¼šè¯ID\r\n   * @returns {Promise<Object>} - AIå›å¤\r\n   */\r\n  async sendMessage(message, conversationId = null) {\r\n    try {\r\n      // å¦‚æœæ²¡æœ‰ä¼šè¯IDï¼Œåˆå§‹åŒ–ä¸€ä¸ª\r\n      if (!conversationId && !this.conversationId) {\r\n        await this.initConversation();\r\n      }\r\n      \r\n      const currentConversationId = conversationId || this.conversationId;\r\n      \r\n      // æ„å»ºDifyèŠå¤©APIè¯·æ±‚ - ä½¿ç”¨æ­£ç¡®çš„APIæ ¼å¼\r\n      const requestData = {\r\n        inputs: {\r\n          query: message\r\n        },\r\n        query: message,\r\n        response_mode: 'streaming', // ä½¿ç”¨streamingæ¨¡å¼ï¼Œå…¼å®¹æ€§æ›´å¥½\r\n        user: 'mini-program-user-' + Date.now(),\r\n        conversation_id: currentConversationId\r\n      };\r\n\r\n      // å‘é€è¯·æ±‚åˆ°DifyèŠå¤©åº”ç”¨\r\n      const response = await uni.request({\r\n        url: `${this.baseURL}/v1/chat-messages`,\r\n        method: 'POST',\r\n        header: {\r\n          'Content-Type': 'application/json',\r\n          'Authorization': difyConfig.server.apiKey\r\n        },\r\n        data: requestData, // ç›´æ¥ä¼ é€’å¯¹è±¡ï¼Œuni.requestä¼šè‡ªåŠ¨åºåˆ—åŒ–\r\n        timeout: 30000 // 30ç§’è¶…æ—¶\r\n      });\r\n\r\n      console.log('Dify APIå“åº”çŠ¶æ€ç :', response.statusCode);\r\n      \r\n      if (response.statusCode === 200) {\r\n        return this.parseChatResponse(response.data);\r\n      } else if (response.statusCode === 401) {\r\n        console.warn('Dify APIè®¤è¯å¤±è´¥ï¼šéœ€è¦æœ‰æ•ˆçš„APIå¯†é’¥');\r\n        // è®¤è¯å¤±è´¥æ—¶ä½¿ç”¨æ¨¡æ‹Ÿå›å¤\r\n        return await this.mockChatResponse(message, 'è®¤è¯å¤±è´¥');\r\n      } else if (response.statusCode === 400) {\r\n        console.warn('Dify APIè¯·æ±‚æ ¼å¼é”™è¯¯ï¼Œæ£€æŸ¥è¯·æ±‚æ•°æ®æ ¼å¼');\r\n        console.log('è¯·æ±‚æ•°æ®:', JSON.stringify(requestData));\r\n        // 400é”™è¯¯æ—¶ä½¿ç”¨æ¨¡æ‹Ÿå›å¤\r\n        return await this.mockChatResponse(message, 'è¯·æ±‚æ ¼å¼é”™è¯¯');\r\n      } else {\r\n        console.warn(`DifyèŠå¤©APIè°ƒç”¨å¤±è´¥: ${response.statusCode}, ä½¿ç”¨æ¨¡æ‹Ÿå›å¤`);\r\n        // å¦‚æœDifyæœåŠ¡ä¸å¯ç”¨ï¼Œä½¿ç”¨æ¨¡æ‹Ÿå›å¤\r\n        return await this.mockChatResponse(message, 'æœåŠ¡ä¸å¯ç”¨');\r\n      }\r\n    } catch (error) {\r\n      console.error('DifyèŠå¤©æœåŠ¡è°ƒç”¨é”™è¯¯:', error);\r\n      // å¦‚æœDifyæœåŠ¡ä¸å¯ç”¨ï¼Œä½¿ç”¨æ¨¡æ‹Ÿå›å¤\r\n      return await this.mockChatResponse(message);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * è§£æDifyèŠå¤©å“åº”\r\n   * @param {Object} responseData - Dify APIå“åº”\r\n   * @returns {Object} - æ ‡å‡†åŒ–çš„èŠå¤©å›å¤\r\n   */\r\n  parseChatResponse(responseData) {\r\n    try {\r\n      // DifyèŠå¤©APIè¿”å›çš„æ•°æ®ç»“æ„å¯èƒ½åŒ…å«å¤šä¸ªäº‹ä»¶\r\n      // è¿™é‡Œç®€åŒ–å¤„ç†ï¼Œæå–æ–‡æœ¬å†…å®¹\r\n      let content = '';\r\n      \r\n      if (responseData.answer) {\r\n        content = responseData.answer;\r\n      } else if (responseData.data && responseData.data.text) {\r\n        content = responseData.data.text;\r\n      } else if (typeof responseData === 'string') {\r\n        content = responseData;\r\n      } else {\r\n        content = JSON.stringify(responseData);\r\n      }\r\n\r\n      // ä»å›å¤ä¸­æå–æ—…è¡Œç›¸å…³ä¿¡æ¯\r\n      const travelInfo = this.extractTravelInfoFromResponse(content);\r\n      \r\n      return {\r\n        success: true,\r\n        content: content,\r\n        conversationId: this.conversationId,\r\n        travelInfo: travelInfo\r\n      };\r\n    } catch (error) {\r\n      console.error('DifyèŠå¤©å“åº”è§£æé”™è¯¯:', error);\r\n      return {\r\n        success: false,\r\n        content: 'æŠ±æ­‰ï¼ŒAIå›å¤è§£æå¤±è´¥ï¼Œè¯·é‡è¯•ã€‚',\r\n        conversationId: this.conversationId,\r\n        travelInfo: null\r\n      };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * ä»AIå›å¤ä¸­æå–æ—…è¡Œä¿¡æ¯\r\n   * @param {string} content - AIå›å¤å†…å®¹\r\n   * @returns {Object} - æå–çš„æ—…è¡Œä¿¡æ¯\r\n   */\r\n  extractTravelInfoFromResponse(content) {\r\n    const travelInfo = {\r\n      destination: '',\r\n      days: 0,\r\n      budget: 0,\r\n      itinerary: [],\r\n      tips: [],\r\n      recommendations: []\r\n    };\r\n\r\n    // æå–ç›®çš„åœ°\r\n    const destinationMatch = content.match(/(åŒ—äº¬|ä¸Šæµ·|å¹¿å·|æ·±åœ³|æ­å·|æˆéƒ½|è¥¿å®‰|å—äº¬|æ­¦æ±‰|é‡åº†|äº‘å—|å¤§ç†|ä¸½æ±Ÿ|ä¸‰äºš|å¦é—¨|é’å²›|å¤§è¿|è‹å·|æ— é”¡|å®æ³¢)/);\r\n    if (destinationMatch) {\r\n      travelInfo.destination = destinationMatch[1];\r\n    }\r\n\r\n    // æå–å¤©æ•°\r\n    const daysMatch = content.match(/(\\d+)[å¤©æ—¥]/);\r\n    if (daysMatch) {\r\n      travelInfo.days = parseInt(daysMatch[1]);\r\n    }\r\n\r\n    // æå–é¢„ç®—\r\n    const budgetMatch = content.match(/(\\d+)[å…ƒå—ä¸‡]/);\r\n    if (budgetMatch) {\r\n      let budget = parseInt(budgetMatch[1]);\r\n      if (content.includes('ä¸‡')) budget *= 10000;\r\n      travelInfo.budget = budget;\r\n    }\r\n\r\n    // æå–è¡Œç¨‹å®‰æ’ï¼ˆç®€åŒ–ç‰ˆï¼‰\r\n    const lines = content.split('\\n');\r\n    let currentDay = null;\r\n    \r\n    lines.forEach(line => {\r\n      const trimmedLine = line.trim();\r\n      \r\n      // æ£€æµ‹æ¯æ—¥è¡Œç¨‹\r\n      if (trimmedLine.match(/^ç¬¬[ä¸€äºŒä¸‰å››äº”å…­ä¸ƒå…«ä¹å]+[å¤©æ—¥]/) || \r\n          trimmedLine.match(/^Day\\s*\\d+/i) ||\r\n          trimmedLine.includes('ä¸Šåˆ') || \r\n          trimmedLine.includes('ä¸‹åˆ') || \r\n          trimmedLine.includes('æ™šä¸Š')) {\r\n        \r\n        if (currentDay) {\r\n          travelInfo.itinerary.push(currentDay);\r\n        }\r\n        \r\n        currentDay = {\r\n          title: trimmedLine,\r\n          activities: []\r\n        };\r\n      } else if (currentDay && trimmedLine.startsWith('-')) {\r\n        currentDay.activities.push(trimmedLine.substring(1).trim());\r\n      }\r\n      \r\n      // æå–æç¤º\r\n      if (trimmedLine.includes('æç¤º') || trimmedLine.includes('å»ºè®®')) {\r\n        travelInfo.tips.push(trimmedLine);\r\n      }\r\n      \r\n      // æå–æ¨è\r\n      if (trimmedLine.includes('æ¨è') || trimmedLine.includes('ç‰¹è‰²')) {\r\n        travelInfo.recommendations.push(trimmedLine);\r\n      }\r\n    });\r\n    \r\n    if (currentDay) {\r\n      travelInfo.itinerary.push(currentDay);\r\n    }\r\n\r\n    return travelInfo;\r\n  }\r\n\r\n  /**\r\n   * ç”Ÿæˆåœ°å›¾æ•°æ®\r\n   * @param {string} destination - ç›®çš„åœ°\r\n   * @returns {Object} - åœ°å›¾æ ‡è®°æ•°æ®\r\n   */\r\n  generateMapData(destination) {\r\n    const coordinates = {\r\n      'åŒ—äº¬': { longitude: 116.3974, latitude: 39.9093 },\r\n      'ä¸Šæµ·': { longitude: 121.4737, latitude: 31.2304 },\r\n      'å¹¿å·': { longitude: 113.2644, latitude: 23.1291 },\r\n      'æ·±åœ³': { longitude: 114.0579, latitude: 22.5431 },\r\n      'æ­å·': { longitude: 120.1551, latitude: 30.2741 },\r\n      'æˆéƒ½': { longitude: 104.0665, latitude: 30.5728 },\r\n      'è¥¿å®‰': { longitude: 108.9402, latitude: 34.3416 },\r\n      'å—äº¬': { longitude: 118.7969, latitude: 32.0603 },\r\n      'æ­¦æ±‰': { longitude: 114.3054, latitude: 30.5931 },\r\n      'é‡åº†': { longitude: 106.5516, latitude: 29.5630 },\r\n      'äº‘å—': { longitude: 102.7123, latitude: 25.0406 },\r\n      'å¤§ç†': { longitude: 100.2676, latitude: 25.6065 },\r\n      'ä¸½æ±Ÿ': { longitude: 100.2330, latitude: 26.8721 }\r\n    };\r\n\r\n    const coord = coordinates[destination] || { longitude: 116.3974, latitude: 39.9093 };\r\n    \r\n    return {\r\n      destination: destination,\r\n      markers: [\r\n        { name: destination, longitude: coord.longitude, latitude: coord.latitude }\r\n      ]\r\n    };\r\n  }\r\n\r\n  /**\r\n   * æ¨¡æ‹ŸèŠå¤©å›å¤ï¼ˆå¤‡ç”¨æ–¹æ¡ˆï¼‰\r\n   * @param {string} message - ç”¨æˆ·æ¶ˆæ¯\r\n   * @returns {Promise<Object>} - æ¨¡æ‹Ÿå›å¤\r\n   */\r\n  async mockChatResponse(message) {\r\n    // æ¨¡æ‹Ÿç½‘ç»œå»¶è¿Ÿ\r\n    await new Promise(resolve => setTimeout(resolve, 1000));\r\n\r\n    // æ ¹æ®ç”¨æˆ·æ¶ˆæ¯ç”Ÿæˆæ™ºèƒ½å›å¤\r\n    let reply = '';\r\n    \r\n    if (message.includes('ä½ å¥½') || message.includes('æ‚¨å¥½')) {\r\n      reply = 'æ‚¨å¥½ï¼æˆ‘æ˜¯AIæ—…è¡ŒåŠ©æ‰‹ï¼Œå¾ˆé«˜å…´ä¸ºæ‚¨æœåŠ¡ï¼è¯·å‘Šè¯‰æˆ‘æ‚¨çš„æ—…è¡Œéœ€æ±‚ï¼Œæ¯”å¦‚æƒ³å»å“ªé‡Œã€å‡ å¤©æ—¶é—´ã€é¢„ç®—å¤šå°‘ç­‰ã€‚';\r\n    } else if (message.includes('äº‘å—') || message.includes('å¤§ç†') || message.includes('ä¸½æ±Ÿ')) {\r\n      reply = 'äº‘å—æ˜¯ä¸ªç¾ä¸½çš„æ—…æ¸¸ç›®çš„åœ°ï¼æˆ‘ä¸ºæ‚¨æ¨èä»¥ä¸‹5æ—¥æ¸¸è·¯çº¿ï¼š\\n\\n' +\r\n              'ğŸ”ï¸ **Day 1ï¼šæŠµè¾¾æ˜†æ˜**\\n' +\r\n              '- ä¸Šåˆï¼šæŠµè¾¾æ˜†æ˜é•¿æ°´æœºåœº\\n' +\r\n              '- ä¸‹åˆï¼šæ¸¸è§ˆæ»‡æ± ã€è¥¿å±±é¾™é—¨\\n' +\r\n              '- æ™šä¸Šï¼šå“å°è¿‡æ¡¥ç±³çº¿\\n\\n' +\r\n              'ğŸï¸ **Day 2ï¼šå¤§ç†å¤åŸ**\\n' +\r\n              '- ä¸Šåˆï¼šåŠ¨è½¦å‰å¾€å¤§ç†ï¼Œæ¸¸è§ˆå¤§ç†å¤åŸ\\n' +\r\n              '- ä¸‹åˆï¼šç¯æ´±æµ·éª‘è¡Œï¼Œæ¬£èµè‹å±±æ´±æµ·\\n' +\r\n              'ğŸ’° **é¢„ç®—å»ºè®®**ï¼š8000å…ƒè¶³å¤Ÿäº«å—èˆ’é€‚æ—…ç¨‹';\r\n    } else if (message.includes('åŒ—äº¬')) {\r\n      reply = 'åŒ—äº¬å†å²æ–‡åŒ–ä¸°å¯Œï¼æ¨è3æ—¥æ¸¸ï¼š\\n\\n' +\r\n              'ğŸ›ï¸ **Day 1ï¼šå¤©å®‰é—¨å¹¿åœº & æ•…å®«**\\n' +\r\n              '- ä¸Šåˆï¼šå¤©å®‰é—¨å¹¿åœºæ‹ç…§ç•™å¿µ\\n' +\r\n              '- ä¸‹åˆï¼šæ¸¸è§ˆæ•…å®«\\n' +\r\n              'ğŸ¼ **Day 2ï¼šé¢å’Œå›­ & åŠ¨ç‰©å›­**\\n' +\r\n              '- é€‚åˆå®¶åº­å‡ºæ¸¸\\n' +\r\n              'ğŸ’° **é¢„ç®—å»ºè®®**ï¼š5000å…ƒå·¦å³';\r\n    } else {\r\n      reply = 'æ„Ÿè°¢æ‚¨åˆ†äº«æ—…è¡Œæƒ³æ³•ï¼ä¸ºäº†æ›´å¥½åœ°ä¸ºæ‚¨å®šåˆ¶è·¯çº¿ï¼Œè¯·å‘Šè¯‰æˆ‘ï¼š\\n\\n' +\r\n              '1. å…·ä½“çš„æ—…è¡Œç›®çš„åœ°\\n' +\r\n              '2. å‡ºè¡Œæ—¶é—´ï¼ˆå‡ å¤©ï¼‰\\n' +\r\n              '3. é¢„ç®—èŒƒå›´\\n' +\r\n              '4. æ‚¨çš„å…´è¶£åå¥½\\n\\n' +\r\n              'æˆ‘ä¼šæ ¹æ®è¿™äº›ä¿¡æ¯ä¸ºæ‚¨æä¾›ä¸“å±å»ºè®®ã€‚';\r\n    }\r\n\r\n    const travelInfo = this.extractTravelInfoFromResponse(reply);\r\n    \r\n    return {\r\n      success: true,\r\n      content: reply,\r\n      conversationId: this.conversationId || 'conv_mock_' + Date.now(),\r\n      travelInfo: travelInfo\r\n    };\r\n  }\r\n\r\n  /**\r\n   * è§£æç”¨æˆ·è¾“å…¥ï¼ˆå…¼å®¹æ€§æ–¹æ³•ï¼‰\r\n   * @param {string} message - ç”¨æˆ·è¾“å…¥\r\n   * @returns {Object} - è§£æåçš„ä¿¡æ¯\r\n   */\r\n  parseUserInput(message) {\r\n    return {\r\n      rawMessage: message,\r\n      destination: this.extractDestination(message),\r\n      days: this.extractDays(message),\r\n      budget: this.extractBudget(message),\r\n      preferences: this.extractPreferences(message),\r\n      travelType: this.extractTravelType(message)\r\n    };\r\n  }\r\n\r\n  /**\r\n   * æå–ç›®çš„åœ°\r\n   */\r\n  extractDestination(message) {\r\n    const match = message.match(/(åŒ—äº¬|ä¸Šæµ·|å¹¿å·|æ·±åœ³|æ­å·|æˆéƒ½|è¥¿å®‰|å—äº¬|æ­¦æ±‰|é‡åº†|äº‘å—|å¤§ç†|ä¸½æ±Ÿ|ä¸‰äºš|å¦é—¨|é’å²›|å¤§è¿|è‹å·|æ— é”¡|å®æ³¢)/);\r\n    return match ? match[1] : '';\r\n  }\r\n\r\n  /**\r\n   * æå–å¤©æ•°\r\n   */\r\n  extractDays(message) {\r\n    const match = message.match(/(\\d+)[å¤©æ—¥]/);\r\n    return match ? parseInt(match[1]) : 3;\r\n  }\r\n\r\n  /**\r\n   * æå–é¢„ç®—\r\n   */\r\n  extractBudget(message) {\r\n    const match = message.match(/(\\d+)[å…ƒå—ä¸‡]/);\r\n    if (match) {\r\n      let budget = parseInt(match[1]);\r\n      if (message.includes('ä¸‡')) budget *= 10000;\r\n      return budget;\r\n    }\r\n    return 5000;\r\n  }\r\n\r\n  /**\r\n   * æå–åå¥½\r\n   */\r\n  extractPreferences(message) {\r\n    if (message.includes('è‡ªç„¶') || message.includes('é£æ™¯')) return 'è‡ªç„¶é£å…‰';\r\n    if (message.includes('å†å²') || message.includes('æ–‡åŒ–')) return 'å†å²æ–‡åŒ–';\r\n    if (message.includes('ç¾é£Ÿ') || message.includes('åƒ')) return 'ç¾é£Ÿ';\r\n    if (message.includes('è´­ç‰©') || message.includes('ä¹°')) return 'è´­ç‰©';\r\n    return 'ç»¼åˆ';\r\n  }\r\n\r\n  /**\r\n   * æå–æ—…è¡Œç±»å‹\r\n   */\r\n  extractTravelType(message) {\r\n    if (message.includes('å®¶åº­') || message.includes('å¸¦å­©å­')) return 'å®¶åº­';\r\n    if (message.includes('æƒ…ä¾£') || message.includes('å¤«å¦»')) return 'æƒ…ä¾£';\r\n    if (message.includes('ç‹¬è‡ª') || message.includes('ä¸€ä¸ªäºº')) return 'ç‹¬è‡ª';\r\n    if (message.includes('æœ‹å‹') || message.includes('åŒå­¦')) return 'æœ‹å‹';\r\n    return 'è‡ªç”±è¡Œ';\r\n  }\r\n}\r\n\r\nexport default new DifyChatService();"],"names":["difyConfig","uni"],"mappings":"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"}