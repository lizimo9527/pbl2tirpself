{"version":3,"file":"guideService.js","sources":["services/guideService.js"],"sourcesContent":["// 攻略数据存储服务\r\nclass GuideService {\r\n  constructor() {\r\n    this.storageKey = 'travel_guides';\r\n    this.initTemplateGuides();\r\n  }\r\n\r\n  // 初始化模板攻略数据\r\n  initTemplateGuides() {\r\n    const guides = this.getAllGuides();\r\n    const templateGuides = this.getTemplateGuides();\r\n    \r\n    // 检查是否已经存在模板攻略\r\n    const existingTemplateIds = guides.filter(g => g.isTemplate).map(g => g.id);\r\n    const newTemplates = templateGuides.filter(template => !existingTemplateIds.includes(template.id));\r\n    \r\n    if (newTemplates.length > 0) {\r\n      const updatedGuides = [...newTemplates, ...guides];\r\n      uni.setStorageSync(this.storageKey, JSON.stringify(updatedGuides));\r\n    }\r\n  }\r\n\r\n  // 获取模板攻略数据\r\n  getTemplateGuides() {\r\n    return [\r\n      {\r\n        id: 'hebei_classic_3days',\r\n        title: '河北经典3日游',\r\n        destination: '承德、秦皇岛、山海关',\r\n        content: `第一天：承德避暑山庄\r\n- 上午：抵达承德，游览避暑山庄，感受清代皇家园林的宏伟\r\n- 下午：参观普宁寺，了解藏传佛教文化\r\n- 晚上：品尝承德特色美食，入住承德市区\r\n\r\n第二天：秦皇岛北戴河\r\n- 上午：前往秦皇岛，游览北戴河海滨浴场\r\n- 下午：参观鸽子窝公园，欣赏海景日落\r\n- 晚上：海鲜大餐，入住北戴河\r\n\r\n第三天：山海关\r\n- 上午：游览天下第一关——山海关\r\n- 下午：参观老龙头，感受长城入海的壮观\r\n- 晚上：返回，结束愉快的河北之旅`,\r\n        tags: ['河北旅游', '经典路线', '3天行程', '历史古迹'],\r\n        status: 'published',\r\n        createTime: '2024-01-01T00:00:00.000Z',\r\n        updateTime: '2024-01-01T00:00:00.000Z',\r\n        isTemplate: true,\r\n        mapMarkers: [\r\n          {\r\n            id: 1,\r\n            latitude: 40.9769,\r\n            longitude: 117.9061,\r\n            title: '承德避暑山庄',\r\n            iconPath: '/static/images/marker.png'\r\n          },\r\n          {\r\n            id: 2,\r\n            latitude: 39.9389,\r\n            longitude: 119.5886,\r\n            title: '北戴河海滨',\r\n            iconPath: '/static/images/marker.png'\r\n          },\r\n          {\r\n            id: 3,\r\n            latitude: 40.0083,\r\n            longitude: 119.7536,\r\n            title: '山海关',\r\n            iconPath: '/static/images/marker.png'\r\n          }\r\n        ]\r\n      },\r\n      {\r\n        id: 'hebei_cultural_5days',\r\n        title: '河北文化深度5日游',\r\n        destination: '保定、正定、赵县',\r\n        content: `第一天：保定直隶总督署\r\n- 上午：抵达保定，参观直隶总督署，了解清代官署建筑\r\n- 下午：游览古莲花池，感受北方园林的精致\r\n- 晚上：品尝保定驴肉火烧，入住保定\r\n\r\n第二天：满城汉墓\r\n- 上午：参观满城汉墓，探索汉代墓葬文化\r\n- 下午：游览清西陵，了解清代帝王陵寝\r\n- 晚上：返回保定市区\r\n\r\n第三天：正定古城\r\n- 上午：前往正定，参观隆兴寺，欣赏宋代木构建筑\r\n- 下午：游览临济寺，了解禅宗文化\r\n- 晚上：入住正定古城\r\n\r\n第四天：赵州桥\r\n- 上午：前往赵县，参观世界闻名的赵州桥\r\n- 下午：游览柏林禅寺，感受佛教文化\r\n- 晚上：返回石家庄\r\n\r\n第五天：石家庄市区\r\n- 上午：参观河北省博物馆\r\n- 下午：自由活动，购物休闲\r\n- 晚上：结束文化之旅`,\r\n        tags: ['河北文化', '深度游', '5天行程', '历史探索'],\r\n        status: 'published',\r\n        createTime: '2024-01-01T00:00:00.000Z',\r\n        updateTime: '2024-01-01T00:00:00.000Z',\r\n        isTemplate: true,\r\n        mapMarkers: [\r\n          {\r\n            id: 1,\r\n            latitude: 38.8510,\r\n            longitude: 115.4900,\r\n            title: '保定直隶总督署',\r\n            iconPath: '/static/images/marker.png'\r\n          },\r\n          {\r\n            id: 2,\r\n            latitude: 38.7350,\r\n            longitude: 114.5700,\r\n            title: '正定隆兴寺',\r\n            iconPath: '/static/images/marker.png'\r\n          },\r\n          {\r\n            id: 3,\r\n            latitude: 37.7560,\r\n            longitude: 114.7690,\r\n            title: '赵州桥',\r\n            iconPath: '/static/images/marker.png'\r\n          }\r\n        ]\r\n      },\r\n      {\r\n        id: 'hebei_natural_4days',\r\n        title: '河北自然风光4日游',\r\n        destination: '野三坡、白石山、苍岩山',\r\n        content: `第一天：野三坡国家地质公园\r\n- 上午：抵达野三坡，游览百里峡景区\r\n- 下午：体验拒马河漂流，感受山水之美\r\n- 晚上：入住野三坡景区\r\n\r\n第二天：白石山国家地质公园\r\n- 上午：前往白石山，欣赏奇峰怪石\r\n- 下午：徒步登山，观赏云海奇观\r\n- 晚上：入住涞源县城\r\n\r\n第三天：苍岩山\r\n- 上午：游览苍岩山，参观悬空寺\r\n- 下午：探访古建筑群，感受宗教文化\r\n- 晚上：返回石家庄\r\n\r\n第四天：嶂石岩\r\n- 上午：前往嶂石岩，欣赏丹霞地貌\r\n- 下午：自由活动，拍照留念\r\n- 晚上：结束自然之旅`,\r\n        tags: ['自然风光', '户外探险', '4天行程', '地质公园'],\r\n        status: 'published',\r\n        createTime: '2024-01-01T00:00:00.000Z',\r\n        updateTime: '2024-01-01T00:00:00.000Z',\r\n        isTemplate: true,\r\n        mapMarkers: [\r\n          {\r\n            id: 1,\r\n            latitude: 39.6830,\r\n            longitude: 115.3880,\r\n            title: '野三坡',\r\n            iconPath: '/static/images/marker.png'\r\n          },\r\n          {\r\n            id: 2,\r\n            latitude: 39.2000,\r\n            longitude: 114.6830,\r\n            title: '白石山',\r\n            iconPath: '/static/images/marker.png'\r\n          },\r\n          {\r\n            id: 3,\r\n            latitude: 37.9500,\r\n            longitude: 114.1500,\r\n            title: '苍岩山',\r\n            iconPath: '/static/images/marker.png'\r\n          }\r\n        ]\r\n      },\r\n      {\r\n        id: 'hebei_greatwall_2days',\r\n        title: '河北长城精华2日游',\r\n        destination: '金山岭长城、喜峰口长城',\r\n        content: `第一天：金山岭长城\r\n- 上午：抵达金山岭，开始长城徒步\r\n- 下午：欣赏长城壮丽景色，拍照留念\r\n- 晚上：入住长城脚下民宿\r\n\r\n第二天：喜峰口长城\r\n- 上午：前往喜峰口，游览水下长城奇观\r\n- 下午：参观潘家口水库，感受长城与水景的完美结合\r\n- 晚上：结束长城之旅`,\r\n        tags: ['长城文化', '摄影之旅', '2天行程', '户外徒步'],\r\n        status: 'published',\r\n        createTime: '2024-01-01T00:00:00.000Z',\r\n        updateTime: '2024-01-01T00:00:00.000Z',\r\n        isTemplate: true,\r\n        mapMarkers: [\r\n          {\r\n            id: 1,\r\n            latitude: 40.6830,\r\n            longitude: 117.2330,\r\n            title: '金山岭长城',\r\n            iconPath: '/static/images/marker.png'\r\n          },\r\n          {\r\n            id: 2,\r\n            latitude: 40.3830,\r\n            longitude: 118.2330,\r\n            title: '喜峰口长城',\r\n            iconPath: '/static/images/marker.png'\r\n          }\r\n        ]\r\n      }\r\n    ];\r\n  }\r\n\r\n  // 获取所有攻略\r\n  getGuides() {\r\n    try {\r\n      const guides = uni.getStorageSync(this.storageKey);\r\n      return guides ? JSON.parse(guides) : [];\r\n    } catch (error) {\r\n      console.error('获取攻略列表失败:', error);\r\n      return [];\r\n    }\r\n  }\r\n\r\n  // 获取所有攻略（兼容旧版本）\r\n  getAllGuides() {\r\n    return this.getGuides();\r\n  }\r\n\r\n  // 根据ID获取攻略详情\r\n  getGuideById(id) {\r\n    const guides = this.getAllGuides();\r\n    return guides.find(guide => guide.id === id);\r\n  }\r\n\r\n  // 保存攻略（创建或更新）\r\n  saveGuide(guideData) {\r\n    try {\r\n      const guides = this.getAllGuides();\r\n      \r\n      if (guideData.id) {\r\n        // 更新现有攻略\r\n        const index = guides.findIndex(guide => guide.id === guideData.id);\r\n        if (index !== -1) {\r\n          guides[index] = {\r\n            ...guides[index],\r\n            ...guideData,\r\n            updateTime: new Date().toISOString()\r\n          };\r\n        }\r\n      } else {\r\n        // 创建新攻略\r\n        const newGuide = {\r\n          id: this.generateId(),\r\n          ...guideData,\r\n          createTime: new Date().toISOString(),\r\n          updateTime: new Date().toISOString(),\r\n          author: 'default',\r\n          // 保持原有的状态，不强制设置为published\r\n          status: guideData.status || 'draft'\r\n        };\r\n        guides.unshift(newGuide); // 新攻略放在最前面\r\n      }\r\n\r\n      uni.setStorageSync(this.storageKey, JSON.stringify(guides));\r\n      return true;\r\n    } catch (error) {\r\n      console.error('保存攻略失败:', error);\r\n      return false;\r\n    }\r\n  }\r\n\r\n  // 删除攻略\r\n  deleteGuide(id) {\r\n    try {\r\n      const guides = this.getAllGuides();\r\n      const filteredGuides = guides.filter(guide => guide.id !== id);\r\n      uni.setStorageSync(this.storageKey, JSON.stringify(filteredGuides));\r\n      return true;\r\n    } catch (error) {\r\n      console.error('删除攻略失败:', error);\r\n      return false;\r\n    }\r\n  }\r\n\r\n  // 获取用户创建的攻略\r\n  getUserGuides(userId = 'default') {\r\n    const guides = this.getAllGuides();\r\n    return guides.filter(guide => guide.author === userId);\r\n  }\r\n\r\n  // 生成唯一ID\r\n  generateId() {\r\n    return 'guide_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);\r\n  }\r\n\r\n  // 搜索攻略\r\n  searchGuides(keyword) {\r\n    const guides = this.getAllGuides();\r\n    if (!keyword) return guides;\r\n    \r\n    const lowerKeyword = keyword.toLowerCase();\r\n    return guides.filter(guide => \r\n      guide.title.toLowerCase().includes(lowerKeyword) ||\r\n      guide.destination.toLowerCase().includes(lowerKeyword) ||\r\n      (guide.tags && guide.tags.some(tag => tag.toLowerCase().includes(lowerKeyword)))\r\n    );\r\n  }\r\n}\r\n\r\nexport default new GuideService();"],"names":["uni"],"mappings":";;AACA,MAAM,aAAa;AAAA,EACjB,cAAc;AACZ,SAAK,aAAa;AAClB,SAAK,mBAAkB;AAAA,EACxB;AAAA;AAAA,EAGD,qBAAqB;AACnB,UAAM,SAAS,KAAK;AACpB,UAAM,iBAAiB,KAAK;AAG5B,UAAM,sBAAsB,OAAO,OAAO,OAAK,EAAE,UAAU,EAAE,IAAI,OAAK,EAAE,EAAE;AAC1E,UAAM,eAAe,eAAe,OAAO,cAAY,CAAC,oBAAoB,SAAS,SAAS,EAAE,CAAC;AAEjG,QAAI,aAAa,SAAS,GAAG;AAC3B,YAAM,gBAAgB,CAAC,GAAG,cAAc,GAAG,MAAM;AACjDA,oBAAG,MAAC,eAAe,KAAK,YAAY,KAAK,UAAU,aAAa,CAAC;AAAA,IAClE;AAAA,EACF;AAAA;AAAA,EAGD,oBAAoB;AAClB,WAAO;AAAA,MACL;AAAA,QACE,IAAI;AAAA,QACJ,OAAO;AAAA,QACP,aAAa;AAAA,QACb,SAAS;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAcT,MAAM,CAAC,QAAQ,QAAQ,QAAQ,MAAM;AAAA,QACrC,QAAQ;AAAA,QACR,YAAY;AAAA,QACZ,YAAY;AAAA,QACZ,YAAY;AAAA,QACZ,YAAY;AAAA,UACV;AAAA,YACE,IAAI;AAAA,YACJ,UAAU;AAAA,YACV,WAAW;AAAA,YACX,OAAO;AAAA,YACP,UAAU;AAAA,UACX;AAAA,UACD;AAAA,YACE,IAAI;AAAA,YACJ,UAAU;AAAA,YACV,WAAW;AAAA,YACX,OAAO;AAAA,YACP,UAAU;AAAA,UACX;AAAA,UACD;AAAA,YACE,IAAI;AAAA,YACJ,UAAU;AAAA,YACV,WAAW;AAAA,YACX,OAAO;AAAA,YACP,UAAU;AAAA,UACX;AAAA,QACF;AAAA,MACF;AAAA,MACD;AAAA,QACE,IAAI;AAAA,QACJ,OAAO;AAAA,QACP,aAAa;AAAA,QACb,SAAS;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAwBT,MAAM,CAAC,QAAQ,OAAO,QAAQ,MAAM;AAAA,QACpC,QAAQ;AAAA,QACR,YAAY;AAAA,QACZ,YAAY;AAAA,QACZ,YAAY;AAAA,QACZ,YAAY;AAAA,UACV;AAAA,YACE,IAAI;AAAA,YACJ,UAAU;AAAA,YACV,WAAW;AAAA,YACX,OAAO;AAAA,YACP,UAAU;AAAA,UACX;AAAA,UACD;AAAA,YACE,IAAI;AAAA,YACJ,UAAU;AAAA,YACV,WAAW;AAAA,YACX,OAAO;AAAA,YACP,UAAU;AAAA,UACX;AAAA,UACD;AAAA,YACE,IAAI;AAAA,YACJ,UAAU;AAAA,YACV,WAAW;AAAA,YACX,OAAO;AAAA,YACP,UAAU;AAAA,UACX;AAAA,QACF;AAAA,MACF;AAAA,MACD;AAAA,QACE,IAAI;AAAA,QACJ,OAAO;AAAA,QACP,aAAa;AAAA,QACb,SAAS;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAmBT,MAAM,CAAC,QAAQ,QAAQ,QAAQ,MAAM;AAAA,QACrC,QAAQ;AAAA,QACR,YAAY;AAAA,QACZ,YAAY;AAAA,QACZ,YAAY;AAAA,QACZ,YAAY;AAAA,UACV;AAAA,YACE,IAAI;AAAA,YACJ,UAAU;AAAA,YACV,WAAW;AAAA,YACX,OAAO;AAAA,YACP,UAAU;AAAA,UACX;AAAA,UACD;AAAA,YACE,IAAI;AAAA,YACJ,UAAU;AAAA,YACV,WAAW;AAAA,YACX,OAAO;AAAA,YACP,UAAU;AAAA,UACX;AAAA,UACD;AAAA,YACE,IAAI;AAAA,YACJ,UAAU;AAAA,YACV,WAAW;AAAA,YACX,OAAO;AAAA,YACP,UAAU;AAAA,UACX;AAAA,QACF;AAAA,MACF;AAAA,MACD;AAAA,QACE,IAAI;AAAA,QACJ,OAAO;AAAA,QACP,aAAa;AAAA,QACb,SAAS;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAST,MAAM,CAAC,QAAQ,QAAQ,QAAQ,MAAM;AAAA,QACrC,QAAQ;AAAA,QACR,YAAY;AAAA,QACZ,YAAY;AAAA,QACZ,YAAY;AAAA,QACZ,YAAY;AAAA,UACV;AAAA,YACE,IAAI;AAAA,YACJ,UAAU;AAAA,YACV,WAAW;AAAA,YACX,OAAO;AAAA,YACP,UAAU;AAAA,UACX;AAAA,UACD;AAAA,YACE,IAAI;AAAA,YACJ,UAAU;AAAA,YACV,WAAW;AAAA,YACX,OAAO;AAAA,YACP,UAAU;AAAA,UACX;AAAA,QACF;AAAA,MACF;AAAA,IACP;AAAA,EACG;AAAA;AAAA,EAGD,YAAY;AACV,QAAI;AACF,YAAM,SAASA,cAAG,MAAC,eAAe,KAAK,UAAU;AACjD,aAAO,SAAS,KAAK,MAAM,MAAM,IAAI,CAAA;AAAA,IACtC,SAAQ,OAAO;AACdA,oBAAc,MAAA,MAAA,SAAA,mCAAA,aAAa,KAAK;AAChC,aAAO;IACR;AAAA,EACF;AAAA;AAAA,EAGD,eAAe;AACb,WAAO,KAAK;EACb;AAAA;AAAA,EAGD,aAAa,IAAI;AACf,UAAM,SAAS,KAAK;AACpB,WAAO,OAAO,KAAK,WAAS,MAAM,OAAO,EAAE;AAAA,EAC5C;AAAA;AAAA,EAGD,UAAU,WAAW;AACnB,QAAI;AACF,YAAM,SAAS,KAAK;AAEpB,UAAI,UAAU,IAAI;AAEhB,cAAM,QAAQ,OAAO,UAAU,WAAS,MAAM,OAAO,UAAU,EAAE;AACjE,YAAI,UAAU,IAAI;AAChB,iBAAO,KAAK,IAAI;AAAA,YACd,GAAG,OAAO,KAAK;AAAA,YACf,GAAG;AAAA,YACH,aAAY,oBAAI,KAAM,GAAC,YAAa;AAAA,UAChD;AAAA,QACS;AAAA,MACT,OAAa;AAEL,cAAM,WAAW;AAAA,UACf,IAAI,KAAK,WAAY;AAAA,UACrB,GAAG;AAAA,UACH,aAAY,oBAAI,KAAM,GAAC,YAAa;AAAA,UACpC,aAAY,oBAAI,KAAM,GAAC,YAAa;AAAA,UACpC,QAAQ;AAAA;AAAA,UAER,QAAQ,UAAU,UAAU;AAAA,QACtC;AACQ,eAAO,QAAQ,QAAQ;AAAA,MACxB;AAEDA,oBAAG,MAAC,eAAe,KAAK,YAAY,KAAK,UAAU,MAAM,CAAC;AAC1D,aAAO;AAAA,IACR,SAAQ,OAAO;AACdA,4EAAc,WAAW,KAAK;AAC9B,aAAO;AAAA,IACR;AAAA,EACF;AAAA;AAAA,EAGD,YAAY,IAAI;AACd,QAAI;AACF,YAAM,SAAS,KAAK;AACpB,YAAM,iBAAiB,OAAO,OAAO,WAAS,MAAM,OAAO,EAAE;AAC7DA,oBAAG,MAAC,eAAe,KAAK,YAAY,KAAK,UAAU,cAAc,CAAC;AAClE,aAAO;AAAA,IACR,SAAQ,OAAO;AACdA,4EAAc,WAAW,KAAK;AAC9B,aAAO;AAAA,IACR;AAAA,EACF;AAAA;AAAA,EAGD,cAAc,SAAS,WAAW;AAChC,UAAM,SAAS,KAAK;AACpB,WAAO,OAAO,OAAO,WAAS,MAAM,WAAW,MAAM;AAAA,EACtD;AAAA;AAAA,EAGD,aAAa;AACX,WAAO,WAAW,KAAK,IAAG,IAAK,MAAM,KAAK,SAAS,SAAS,EAAE,EAAE,OAAO,GAAG,CAAC;AAAA,EAC5E;AAAA;AAAA,EAGD,aAAa,SAAS;AACpB,UAAM,SAAS,KAAK;AACpB,QAAI,CAAC;AAAS,aAAO;AAErB,UAAM,eAAe,QAAQ;AAC7B,WAAO,OAAO;AAAA,MAAO,WACnB,MAAM,MAAM,cAAc,SAAS,YAAY,KAC/C,MAAM,YAAY,cAAc,SAAS,YAAY,KACpD,MAAM,QAAQ,MAAM,KAAK,KAAK,SAAO,IAAI,YAAa,EAAC,SAAS,YAAY,CAAC;AAAA,IACpF;AAAA,EACG;AACH;AAEA,MAAe,eAAA,IAAI,aAAc;;"}